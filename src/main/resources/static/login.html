<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Smart Farmer - Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body class="bg-light">
    <div
      class="container d-flex align-items-center justify-content-center min-vh-100"
    >
      <div class="card shadow p-4" style="max-width: 420px; width: 100%">
        <h3 class="text-center text-primary fw-bold mb-2">Smart Farmer</h3>
        <p class="text-center text-muted mb-4">
          Sign in to manage your crops and expenses
        </p>

        <form id="loginForm">
          <div class="mb-3">
            <label class="form-label">Username</label>
            <input id="username" class="form-control" required />
          </div>
          <div class="mb-3">
            <label class="form-label">Password</label>
            <input
              id="password"
              type="password"
              class="form-control"
              required
            />
          </div>
          <div class="mb-3">
            <label class="form-label">Role</label>
            <select id="role" class="form-select">
              <option value="FARMER">Farmer</option>
              <option value="USER">User</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary w-100">Login</button>
          <p id="msg" class="text-danger mt-3 text-center small"></p>
        </form>

        <!-- üåæ Demo login details -->
        <div class="mt-4 bg-light border rounded p-3 small">
          <p class="fw-semibold text-primary mb-2">Demo Accounts:</p>
          <div class="mb-2">
            üë®‚Äçüåæ <strong>Farmer Login</strong><br />
            <code>Username:</code> <span class="text-dark">farmer1</span><br />
            <code>Password:</code> <span class="text-dark">farmer123</span>
          </div>
          <div>
            üë§ <strong>User Login</strong><br />
            <code>Username:</code> <span class="text-dark">user1</span><br />
            <code>Password:</code> <span class="text-dark">user1234</span>
          </div>
        </div>

        <p class="text-center text-muted small mt-3">
          No account?
          <a href="#" id="registerBtn" class="text-decoration-none"
            >Register here</a
          >
        </p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const msg = document.getElementById("msg");
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value;
          const role = document.getElementById("role").value;
          try {
            const res = await fetch("/api/auth/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password, role }),
            });
            const data = await res.json();
            if (!data.success) {
              msg.textContent = data.message || "Invalid username or password";
              return;
            }
            sessionStorage.setItem("sf_user", JSON.stringify(data.user));
            location.href = "dashboard.html";
          } catch (err) {
            msg.textContent = "Server error";
          }
        });

      // Demo register link
      document
        .getElementById("registerBtn")
        .addEventListener("click", async () => {
          const username = prompt("Enter username");
          if (!username) return;
          const password = prompt("Enter password");
          if (!password) return;
          const role = document.getElementById("role").value;
          const res = await fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username,
              password,
              role,
              fullName: username,
            }),
          });
          const d = await res.json();
          if (d.success) alert("Registered successfully! Now login.");
          else alert("Failed: " + (d.message || ""));
        });
    </script>
  </body>
</html>
